{% requirePermission 'qarr:accessRules' %}

{% extends "_layouts/cp" %}
{% set title = "Rules"|t('qarr') %}
{% set currentPage = craft.app.request.getSegment(2) %}
{% set bodyClass = 'qarr-global qarr-static-elements' %}
{% set selectedSubnavItem = "rules" %}

{% do view.registerAssetBundle("owldesign\\qarr\\web\\assets\\UI") %}
{% do view.registerAssetBundle("owldesign\\qarr\\web\\assets\\ElementStatic") %}

{% block header %}
    {% include 'qarr/_ui/page-header' ignore missing %}
{% endblock %}

{% block content %}

    <a href="{{ url('qarr/rules/new') }}" class="qarr-btn">
        <span class="icon mr-3 font-bold">+</span>
        <span class="btn-text">{{ "New Rule"|t('qarr') }}</span>
    </a>

    <div id="noelements" class="text-gray-600 mt-6 {% if rules %}hidden{% endif %}">
        {{ "No rules exist yet."|t('qarr') }}
    </div>

    {% if rules|length %}
        <div class="elements-list">

            {% for rule in rules %}
                {% set status = rule.enabled ? 'enabled' : 'disabled' %}
                <div class="element-item">

                    <div class="element-header w-1/2">
                        <a href="{{ url('qarr/rules/' ~ rule.id) }}"><h2>{{ rule.name }}</h2></a>
                        <span class="block font-mono text-xs element-handle">{{ rule.handle }}</span>
                    </div>

                    <div class="element-body text-center">
                        <h3 class="font-normal text-gray-500">{{ 'Flagged Entries'|t('qarr') }}</h3>
                        <span class="block font-mono element-count">
                            {{ craft.qarrRules.getFlaggedCountByRuleId(rule.id) }}
                        </span>
                    </div>

                    <div class="element-status {{ status }} ">
                        <div class="qarr-tag"><span>{{ status }}</span></div>
                    </div>

                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endblock %}