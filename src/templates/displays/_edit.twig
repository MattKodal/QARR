{% requirePermission 'qarr:accessDisplays' %}

{% extends craft.craftify ? 'qarr/_layouts/cp-static-craft' : 'qarr/_layouts/cp-static-craft' %}

{% import "_includes/forms" as forms %}
{% import "qarr/_ui/buttons" as buttons %}

{% set title = "Displays"|t('qarr') %}
{% set selectedSubnavItem = "displays" %}
{% set fullPageForm = true %}

{% do view.registerAssetBundle("owldesign\\qarr\\web\\assets\\Displays") %}

{% set tabs = [
    {
        'id': 'display',
        'label': 'Display',
        'url': '#display'
    },
    {
        'id': 'fields',
        'label': 'Fields',
        'url': '#fields'
    }
] %}

{% block actionButton %}
    <div id="save-btn-container" class="btngroup submit">
        <input type="submit" class="btn submit" value="{{ 'Save'|t('app') }}">
        <div class="btn submit menubtn"></div>
        <div class="menu" data-align="right">
            <ul>
                <li>
                    <a class="formsubmit" data-redirect="{{ '{cpEditUrl}'|hash }}">
                        {{ forms.optionShortcutLabel('S') }}
                        {{ "Save and continue editing"|t('app') }}
                    </a>
                </li>
                <li>
                    <a class="formsubmit" data-redirect="{{ "qarr/displays/new"|hash }}">
                        {{ "Save and add another"|t('app') }}
                    </a>
                </li>
            </ul>
            <hr>
            <ul>
                <li>
                    <a class="formsubmit error" data-action="qarr/displays/delete"
                       data-confirm="{{ 'Are you sure you want to delete this display?'|t('qarr') }}"
                       data-redirect="{{ 'qarr/displays'|hash }}">
                        {{ 'Delete display'|t('app') }}
                    </a>
                </li>
            </ul>
        </div>
    </div>
{% endblock %}

{% block header %}
    {% if not craft.craftify %}
        {% include 'qarr/_layouts/header-qarr' ignore missing %}
    {% endif %}
    {{ parent() }}
{% endblock %}

{% block content %}
    <div id="display">
        {{ actionInput('qarr/displays/save') }}
        {{ redirectInput('qarr/displays') }}

        {% if display.id %}{{ hiddenInput('id', display.id) }}{% endif %}

        {{ forms.textField({
            label: "Name"|t('app'),
            siteId: display.name,
            id: 'name',
            name: 'name',
            autofocus: true,
            autocorrect: false,
            autocapitalize: false,
            value: display.name,
            placeholder: "Enter name"|t('qarr'),
            errors: (display.getErrors('name'))
        }) }}


        {{ forms.textField({
            label: "Title Format"|t('qarr'),
            siteId: display.titleFormat,
            id: 'titleFormat',
            name: 'titleFormat',
            instructions: 'eg. Review from {fullName} submitted on {dateCreated}',
            autocorrect: false,
            autocapitalize: false,
            value: display.titleFormat,
            placeholder: "Enter title format"|t('qarr'),
            errors: (display.getErrors('titleFormat'))
        }) }}

        <div id="title-format-items" class="flex mt-2">
            <button type="button" class="tag-link qarr-btn btn-small" data-target="#titleFormat"
                    data-field="{dateCreated}">Date Created
            </button>
            <button type="button" class="tag-link qarr-btn btn-small" data-target="#titleFormat"
                    data-field="{fullName}">Full Name
            </button>
            <button type="button" class="tag-link qarr-btn btn-small" data-target="#titleFormat"
                    data-field="{emailAddress}">Email Address
            </button>
        </div>
    </div>

    <div id="fields" class="hidden">
        {% include "qarr/_elements/element-field-layout-designer" with {
            fieldLayout: display.getFieldLayout(),
            customizableTabs: true,
            display: display
        } only %}
    </div>

{% endblock %}

{% block details %}
    <div id="settings" class="meta">
        {{ forms.textField({
            label: "Handle"|t('app'),
            siteId: display.siteId,
            id: 'handle',
            name: 'handle',
            autocorrect: false,
            autocapitalize: false,
            value: display.handle,
            placeholder: "Enter handle"|t('qarr'),
            errors: (display.getErrors('handle'))
        }) }}

        {{ forms.lightswitchField({
            label: "Enable display"|t('qarr'),
            id: 'enabled',
            name: 'enabled',
            on: display.enabled
        }) }}
    </div>
{% endblock %}

{% js %}
    {% if display and not display.handle %}new Craft.HandleGenerator('#name', '#handle');{% endif %}
{% endjs %}