{% requirePermission 'qarr:accessRules' %}

{% extends "_layouts/cp" %}
{% set title = "Rules"|t('qarr') %}
{% set currentPage = craft.app.request.getSegment(2) %}
{% set bodyClass = 'qarr-global qarr-static-elements' %}
{% set selectedSubnavItem = "rules" %}

{% do view.registerAssetBundle("owldesign\\qarr\\web\\assets\\ElementIndex") %}

{% block actionButton %}
    <a href="{{ url('qarr/rules/new') }}" id="add-route-btn" class="btn submit add icon">{{ "New rule"|t('qarr') }}</a>
{% endblock %}

{% block content %}

    <div id="noelements" class="text-gray-600 mt-6 {% if rules %}hidden{% endif %}">
        {{ "No rules exist yet."|t('qarr') }}
    </div>

    {% if rules|length %}
        <div class="elements-list">

            {% for rule in rules %}
                {% set status = rule.enabled ? 'enabled' : 'disabled' %}
                <div class="element-item">

                    <div class="element-header w-1/2">
                        <a href="{{ url('qarr/rules/' ~ rule.id) }}"><h2>{{ rule.name }}</h2></a>
                        <div class="element-handle">
                            <span>{{ rule.handle }}</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="fill-current" width="10" height="10"
                                 viewBox="0 0 20 20">
                                <path d="M6 6V2c0-1.1.9-2 2-2h10a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-4v4a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V8c0-1.1.9-2 2-2h4zm2 0h4a2 2 0 0 1 2 2v4h4V2H8v4zM2 8v10h10V8H2z"/>
                            </svg>
                        </div>
                    </div>

                    <div class="element-body text-center">
                        <h3 class="font-normal text-gray-500">{{ 'Flagged Entries'|t('qarr') }}</h3>
                        <span class="block font-mono element-count">
                                {{ craft.qarrRules.getFlaggedCountByRuleId(rule.id) }}
                            </span>
                    </div>

                    <div class="element-status {{ status }} ">
                        <div class="qarr-tag"><span>{{ status }}</span></div>
                    </div>

                </div>
            {% endfor %}
        </div>
    {% endif %}

{% endblock %}