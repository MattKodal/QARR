var QarrPrompt=Garnish.Base.extend({modal:null,$modalContainerDiv:null,$prompt:null,$promptChoices:null,init:function(t,e){this.showPrompt(t,e,$.proxy(this,"_handleSelection"))},showPrompt:function(t,e,s){this._promptCallback=s,null===this.modal&&(this.modal=new Garnish.Modal({closeOtherModals:!1})),null===this.$modalContainerDiv&&(this.$modalContainerDiv=$('<div class="modal fitted prompt-modal"></div>').addClass().appendTo(Garnish.$bod)),this.$prompt=$('<div class="body"></div>').appendTo(this.$modalContainerDiv.empty()),this.$promptMessage=$('<p class="prompt-msg"/>').appendTo(this.$prompt),this.$promptChoices=$('<div class="options"></div>').appendTo(this.$prompt),this.$promptButtons=$('<div class="buttons right"/>').appendTo(this.$prompt),this.modal.setContainer(this.$modalContainerDiv),this.$promptMessage.html(t);var i=$('<div class="btn">'+Craft.t("qarr","Cancel")+"</div>").appendTo(this.$promptButtons),a=$('<input type="submit" class="btn submit" value="'+Craft.t("qarr","OK")+'" />').appendTo(this.$promptButtons);if(e){a.addClass("disabled");for(var l=0;l<e.length;l++){var n=$('<div><label><input type="radio" name="promptAction" value="'+e[l].value+'"/> '+e[l].title+"</label></div>").appendTo(this.$promptChoices).find("input");this.addListener(n,"click",function(){a.removeClass("disabled")})}}this.addListener(a,"activate",function(t){if(this.choices){var e=$(t.currentTarget).parents(".modal").find("input[name=promptAction]:checked").val();this._selectPromptChoice(e)}else this._selectPromptChoice("ok")}),this.addListener(i,"activate",function(){this._selectPromptChoice("cancel")}),this.modal.show(),this.modal.removeListener(Garnish.Modal.$shade,"click"),this.addListener(Garnish.Modal.$shade,"click","_cancelPrompt")},_handleSelection:function(t){this.trigger("response",{response:t})},_selectPromptChoice:function(t){this.$prompt.fadeOut("fast",$.proxy(function(){this.modal.hide(),this._promptCallback(t)},this))},_cancelPrompt:function(){this._selectPromptChoice("cancel",!0)}}),QarrInputField=Garnish.Base.extend({$el:null,$input:null,$label:null,$inputIcon:null,$noticeIcon:null,hadError:!1,labelText:null,errorMessage:null,init:function(t){this.$el=$(t),this.$input=this.$el.find("input"),this.$label=this.$el.find("label"),this.$inputIcon=this.$el.find(".qarr-input-icon"),this.$noticeIcon=this.$el.find(".qarr-notice-icon"),this.labelText=this.$label.data("label"),this.errorMessage=this.$label.data("error-message"),this.addListener(this.$input,"change","inputChange"),this.addListener(this.$input,"keyup","inputKeyup"),this.addListener(this.$input,"focus focusout","inputFocus"),this.$el.hasClass("custom-select")&&(this.addListener(this.$el.find("select"),"change","inputChange"),this.selectElement())},selectElement:function(){var t=this;this.$el.on("select2:opening",function(e){t.$el.addClass("has-focus")}),this.$el.on("select2:closing",function(e){t.$el.removeClass("has-focus")})},inputFocus:function(){this.checkInputFocus()},inputKeyup:function(){var t=this.$input.val();!t&&this.hadError&&(this.$el.addClass("has-error"),this.$label.html(this.errorMessage)),this.$el.hasClass("has-error")&&(this.hadError=!0,t&&(this.$el.removeClass("has-error"),this.$label.html(this.labelText)))},inputChange:function(){this.checkInputValue()},checkInputFocus:function(){this.$input.is(":focus")?this.$el.addClass("has-focus"):this.$el.removeClass("has-focus"),this.checkInputValue()},checkInputValue:function(){var t=this.$input.val();this.$el.hasClass("custom-select")&&(t=this.$el.find("select").select2("data"),this.$el.hasClass("has-error")&&(this.hadError=!0),this.hadError&&t&&(this.$el.removeClass("has-error"),this.$label.html(this.labelText))),t?this.$el.addClass("has-value"):this.$el.removeClass("has-value")}}),QarrTextareaField=Garnish.Base.extend({$el:null,$textarea:null,$label:null,$inputIcon:null,$noticeIcon:null,hadError:!1,labelText:null,errorMessage:null,init:function(t){this.$el=$(t),this.$textarea=this.$el.find("textarea"),this.$label=this.$el.find("label"),this.$inputIcon=this.$el.find(".qarr-input-icon"),this.$noticeIcon=this.$el.find(".qarr-notice-icon"),this.labelText=this.$label.data("label"),this.errorMessage=this.$label.data("error-message"),this.addListener(this.$textarea,"change","inputChange"),this.addListener(this.$textarea,"keyup","inputKeyup"),this.addListener(this.$textarea,"focus focusout","inputFocus")},inputFocus:function(){this.checkInputFocus()},inputKeyup:function(){var t=this.$textarea.val();!t&&this.hadError&&(this.$el.addClass("has-error"),this.$label.html(this.errorMessage)),this.$el.hasClass("has-error")&&(this.hadError=!0,t&&(this.$el.removeClass("has-error"),this.$label.html(this.labelText)))},inputChange:function(){this.checkInputValue()},checkInputFocus:function(){this.$textarea.is(":focus")?this.$el.addClass("has-focus"):this.$el.removeClass("has-focus")},checkInputValue:function(){this.$textarea.val()?this.$el.addClass("has-value"):this.$el.removeClass("has-value")}});
