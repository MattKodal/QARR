Garnish.$doc.ready(function(){new Vue({el:"#email-template-app",data:function(){return{iframe:null,options:{},templatePath:"simple",element:"review",elementId:null,settings:{bgColor:"#f4f4f4",containerColor:"#ffffff"},body:"",footer:""}},created:function(){this.updateIframe()},mounted:function(){templateSuggest.$on("templateSelected",this.onTemplatePathChanged),this.elementId=$("#element-id").val(),""!==$("#template").val()?this.templatePath=$("#template").val():this.templatePath="simple",this.settings.bgColor=$("#tmp-bg-color-field input").val(),this.settings.containerColor=$("#tmp-container-color-field input").val(),this.body=$("#tmp-body-field textarea").val(),this.footer=$("#tmp-footer-field textarea").val(),this.updateIframe()},methods:{onTemplatePathChanged:function(e){this.templatePath=e.item.name,this.updateIframe()},onBgColorChanged:function(e){this.settings.bgColor=e.target.value,this.updateIframe()},onContainerColorChanged:function(e){this.settings.containerColor=e.target.value,this.updateIframe()},onBodyChanged:function(e){this.body=e.target.value,this.updateIframe()},onFooterChanged:function(e){this.footer=e.target.value,this.updateIframe()},onElementChanged:function(e){this.element=e.target.value,this.updateIframe(!0)},initColorInputs:function(e){$.each(e,function(e,t){var n=$(t).attr("id");new QarrColorInput("#".concat(n,"-container"))})},updateIframe:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n={templatePath:this.templatePath,element:this.element,body:this.body,footer:this.footer,settings:this.settings,elementId:this.elementId,forceUpdate:t};return n[Craft.csrfTokenName]=Craft.csrfTokenValue,axios.post(Craft.getActionUrl("qarr/campaigns/email-templates/get-email-template-preview"),n,{headers:{"X-CSRF-Token":Craft.csrfTokenValue}}).then(function(t){e.elementId=t.data.elementId;var n=$('<iframe class="lp-preview" frameborder="0" width="100%" height="100%"/>');n.appendTo(e.$el),n.on("load",function(){e.iframe&&e.iframe.remove(),e.iframe=n,e.iframe.off()}),Garnish.requestAnimationFrame($.proxy(function(){n[0].contentWindow.document.open(),n[0].contentWindow.document.write(t.data.template),n[0].contentWindow.document.close(),n[0].height=n[0].contentWindow.document.body.scrollHeight+60},e))})}}})});
