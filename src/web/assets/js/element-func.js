var FeedbackResponse=Garnish.Base.extend({$replyBtn:null,$replyDeleteBtn:null,$replyEditBtn:null,$container:null,$spinner:null,id:null,elementId:null,reply:null,modal:null,init:function(t){this.$container=t;var e=this.$container.find(".response-container");this.id=e.data("id"),this.elementId=e.data("element-id"),this.reply=e.data("reply"),this.$replyBtn=this.$container.find("#reply-to-feedback"),this.$replyEditBtn=this.$container.find("#edit-feedback-btn"),this.$replyDeleteBtn=this.$container.find("#delete-feedback-btn"),this.addListener(this.$replyEditBtn,"click","handleEditReply"),this.addListener(this.$replyDeleteBtn,"click","handleDeleteReply")},handleEditReply:function(){this.modal?(delete this.modal,this.modal=new ReplyModal(this,"edit",this.elementId)):this.modal=new ReplyModal(this,"edit",this.elementId)},handleDeleteReply:function(t){var e=this;t.preventDefault();var s={id:this.id};Craft.postActionRequest("qarr/replies/delete",s,$.proxy(function(t,s){t.success&&(Craft.cp.displayNotice(Craft.t("qarr","Reply deleted")),e.$container.html(""),$("#reply-to-feedback").removeClass("disabled"),e.$container.parent().parent().removeClass("has-response"))},this))}}),ReplyModal=Garnish.Modal.extend({$parentContainer:null,$form:null,$modalContainer:null,$errorContainer:null,$spinner:null,isValidate:!1,type:null,elementId:null,parent:null,init:function(t,e,s){this.base(),this.$parentContainer=Garnish.$bod.find(".response"),this.type=e,this.parent=t,this.elementId=s,t&&(this.id=t.id),this.$form=$('<form class="modal fitted qarr-modal prompt-modal">').appendTo(Garnish.$bod),this.setContainer(this.$form);var n=Craft.t("qarr","Add reply");"edit"===this.type&&(n=Craft.t("qarr","Update reply")),this.$modalContainer=$('\n                <div class="header">\n                    <h1>'.concat(Craft.t("qarr","Replying to feedback"),'</h1>\n                </div>\n                \n                <div class="body">\n                    <div class="field">\n                        <div class="heading">\n                            <label class="qarr-label">').concat(Craft.t("qarr","Reply message"),'</label>\n                        </div>\n                        <div class="input">\n                            <textarea id="reply-text" class="text fullwidth template ltr" rows="6" cols="70" placeholder="').concat(Craft.t("qarr","Leave a reply..."),'"></textarea>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="footer">\n                    <div class="buttons right last">\n                        <input type="button" class="btn cancel" value="').concat(Craft.t("qarr","Cancel"),'">\n                        <input type="submit" class="btn submit" value="').concat(n,'">\n                        <span class="spinner hidden"></span>\n                    </div>\n                </div>\n        ')),this.$modalContainer.appendTo(this.$form),this.show(),this.$cancelBtn=this.$modalContainer.find(".cancel"),this.$replyTextarea=this.$modalContainer.find("#reply-text"),this.$errorContainer=this.$modalContainer.find(".error-message"),this.$spinner=this.$modalContainer.find(".spinner"),"edit"===this.type&&this.$replyTextarea.val(this.parent.reply),setTimeout($.proxy(function(){this.$replyTextarea.focus()},this),100),this.addListener(this.$cancelBtn,"click","handleCancel"),this.addListener(this.$form,"submit","handleOk")},handleOk:function(t){var e=this;if(t.preventDefault(),this.validateForm(),this.isValidate){var s={id:this.id,reply:this.reply,elementId:this.elementId};Craft.postActionRequest("qarr/replies/save",s,$.proxy(function(t,s){"success"===s&&("new"===e.type?Craft.cp.displayNotice(Craft.t("qarr","Reply added")):Craft.cp.displayNotice(Craft.t("qarr","Reply updated")),e.$parentContainer.html(t.template),new FeedbackResponse(e.$parentContainer),$("#reply-to-feedback").addClass("disabled"),e.$parentContainer.parent().parent().addClass("has-response"),e.handleSuccess())},this))}},validateForm:function(){this.reply=this.$replyTextarea.val(),this.$spinner.removeClass("hidden"),""===this.reply?(Garnish.shake(this.$container),this.$spinner.addClass("hidden"),this.$replyTextarea.addClass("error"),this.$errorContainer.html(this.$errorContainer.data("error-message")),this.isValidate=!1):(this.$spinner.addClass("hidden"),this.$replyTextarea.removeClass("error"),this.$errorContainer.html(""),this.isValidate=!0)},handleSuccess:function(){this.hide()},handleCancel:function(){this.hide()}}),QarrEmailCorrespondencePreview=Garnish.Base.extend({$btn:null,init:function(t){this.$btn=$(t),console.log(this.$btn)}}),QarrEmailCorrespondence=Garnish.Base.extend({$btn:null,$btnText:null,$loader:null,type:null,entryId:null,modal:null,templates:null,init:function(t){this.$btn=$(t),this.entryId=$(t).data("element-id"),this.type=$(t).data("type"),this.$btnText=this.$btn.find(".link-text"),this.$loader=this.$btn.find(".loader"),this.getAvailableTemplates(),this.addListener(this.$btn,"click","openEmailModal")},openEmailModal:function(t){t.preventDefault(),this.modal?(delete this.modal,this.modal=new QarrEmailModal(this)):this.modal=new QarrEmailModal(this),this.modal.on("save",$.proxy(this,"sendEmail"))},sendEmail:function(t){var e=this,s=t.email;t={type:this.type,entryId:this.entryId,subject:s.subject,message:s.message,templateId:s.templateId},this.$btnText.addClass("hide"),this.$loader.removeClass("hidden"),Craft.postActionRequest("qarr/correspondence/send-mail",t,$.proxy(function(t,s){console.log(t),"success"===s&&e.emailSent(t.entry)},this)),this.modal.hide()},emailSent:function(t){var e=this.$btn.parent().parent().find(".block-body"),s=$(['<div class="block-field mb-4">','<div class="text-xs opacity-50 mb-2">'+Craft.t("qarr","Sent now")+"</div>",'<div class="mb-2"><span class="font-semibold">'+Craft.t("qarr","Subject")+'</span> <p class="m-0">'+t.subject+"</p></div>",'<div class="mb-2"><span class="font-semibold">'+Craft.t("qarr","Message")+'</span> <p class="m-0">'+t.message+"</p></div>","</div>"].join(""));e.append(s),Craft.cp.displayNotice(Craft.t("qarr","Mail sent"))},getAvailableTemplates:function(){var t=this;Craft.postActionRequest("qarr/campaigns/email-templates/get-all-email-templates",$.proxy(function(e,s){e.success&&(t.templates=e.options)},this))}}),QarrEmailModal=Garnish.Modal.extend({$body:null,isValid:!1,parent:null,init:function(t){var e=this;this.base(),this.parent=t,this.$form=$('<form class="modal fitted qarr-modal prompt-modal modal-blue">').appendTo(Garnish.$bod),this.setContainer(this.$form);var s=Craft.t("qarr","We received your {rating} star rating!"),n=Craft.t("qarr","Any submission data can be used here eg. {rating}"),a=Craft.t("qarr","{fullName} thank you for your {rating} star submission."),i=Craft.t("qarr","Markdown allowed. Any submission data can be used here eg. {fullName}");"questions"===this.parent.type&&(s=Craft.t("qarr","We received your question about {element.title}!"),n=Craft.t("qarr","Any submission data can be used here eg. {element.title}"),a=Craft.t("qarr","{fullName} thank you for your question.")),this.$body=$('\n                <div class="header">\n                    <h1>'.concat(Craft.t("qarr","Sending Email"),'</h1>\n                </div>\n                \n                <div class="body">\n                    <div class="field">\n                        <div class="heading">\n                            <label class="qarr-label" for="reply-template">').concat(Craft.t("qarr","Email Template"),'</label>\n                            <div class="instructions"><p>').concat(Craft.t("qarr","Select email template if you want to use custom template"),'</p></div>\n                        </div>\n                        <div class="input">\n                            <div class="select fullwidth">\n                                <select name="template" id="reply-template" class="text fullwidth">\n                                    <option value="0" selected>Default</option>\n                                    ').concat(Object.keys(this.parent.templates).map(function(t){return'<option value="'+e.parent.templates[t].id+'">'+e.parent.templates[t].name+"</option>"}).join(""),'\n                                </select>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class="field">\n                        <div class="heading">\n                            <label class="qarr-label" for="reply-subject">').concat(Craft.t("qarr","Subject"),'</label>\n                            <div class="instructions"><p>').concat(n,'</p></div>\n                        </div>\n                        <div class="input">\n                            <input class="text fullwidth" type="text" id="reply-subject" name="reply-subject" autocomplete="off" placeholder="').concat(s,'">\n                        </div>\n                    </div>\n                    \n                    <div class="field">\n                        <div class="heading">\n                            <label class="qarr-label">').concat(Craft.t("qarr","Message"),'</label>\n                            <div class="instructions"><p>').concat(i,'</p></div>\n                        </div>\n                        <div class="input">\n                            <textarea id="reply-message" class="text fullwidth" rows="12" cols="70" placeholder="').concat(a,'"></textarea>\n                        </div>\n                    </div>\n                    \n                    <ul class="qarr-errors"></ul>\n                </div>\n                \n                <div class="footer">\n                    <div class="buttons right last">\n                        <input type="button" class="btn cancel" value="').concat(Craft.t("qarr","Cancel"),'">\n                        <input type="submit" class="btn submit" value="').concat(Craft.t("qarr","Send"),'">\n                        <span class="spinner hidden"></span>\n                    </div>\n                </div>\n        ')),this.$body.appendTo(this.$form),this.show(),this.$cancelBtn=this.$body.find(".cancel"),this.$subjectInput=this.$body.find("#reply-subject"),this.$messageInput=this.$body.find("#reply-message"),this.$templateInput=this.$body.find("#reply-template"),setTimeout($.proxy(function(){e.$subjectInput.focus()},this),100),this.addListener(this.$cancelBtn,"click","hide"),this.addListener(this.$form,"submit","save")},save:function(t){var e=this;t.preventDefault();var s=this.$form.find(".qarr-errors");this.email={subject:this.$subjectInput.val(),message:this.$messageInput.val(),templateId:this.$templateInput.val()},s.html(""),this.$subjectInput.removeClass("error"),this.$messageInput.removeClass("error"),this.$templateInput.removeClass("error"),$.each(this.email,function(t,s){""===s&&(e.isValid=!1)}),""===this.$subjectInput.val()||""===this.$messageInput.val()?(Garnish.shake(this.$container),""===this.$subjectInput.val()&&(this.$subjectInput.addClass("error"),s.append("<li>"+Craft.t("qarr","Subject is required")+"</li>")),""===this.$messageInput.val()&&(this.$messageInput.addClass("error"),s.append("<li>"+Craft.t("qarr","Message is required")+"</li>"))):this.trigger("save",{email:this.email}),this.updateSizeAndPosition()}}),QarrPrompt=Garnish.Base.extend({modal:null,$modalContainerDiv:null,$prompt:null,$promptChoices:null,init:function(t,e){this.showPrompt(t,e,$.proxy(this,"_handleSelection"))},showPrompt:function(t,e,s){this._promptCallback=s,null===this.modal&&(this.modal=new Garnish.Modal({closeOtherModals:!1})),null===this.$modalContainerDiv&&(this.$modalContainerDiv=$('<div class="modal fitted prompt-modal"></div>').addClass().appendTo(Garnish.$bod)),this.$prompt=$('<div class="body"></div>').appendTo(this.$modalContainerDiv.empty()),this.$footer=$('<div class="footer"></div>').appendTo(this.$modalContainerDiv),this.$promptMessage=$('<p class="prompt-msg"/>').appendTo(this.$prompt),this.$promptChoices=$('<div class="options"></div>').appendTo(this.$prompt),this.$promptButtons=$('<div class="buttons right"/>').appendTo(this.$footer),this.modal.setContainer(this.$modalContainerDiv),this.$promptMessage.html('<div class="font-medium">'+t+"</div>");var n=$('<input type="button" class="btn cancel" value="'.concat(Craft.t("qarr","Cancel"),'">')).appendTo(this.$promptButtons),a=$('<input type="submit" class="btn submit" value="'.concat(Craft.t("qarr","OK"),'">')).appendTo(this.$promptButtons);if(e){a.addClass("disabled");for(var i=0;i<e.length;i++){var l=$('<div><label><input type="radio" name="promptAction" value="'+e[i].value+'"/> '+e[i].title+"</label></div>").appendTo(this.$promptChoices).find("input");this.addListener(l,"click",function(){a.removeClass("disabled")})}}this.addListener(a,"click",function(t){if(t.preventDefault(),this.choices){var e=$(t.currentTarget).parents(".modal").find("input[name=promptAction]:checked").val();this._selectPromptChoice(e)}else this._selectPromptChoice("ok")}),this.addListener(n,"click",function(){this._selectPromptChoice("cancel")}),this.modal.show(),this.modal.removeListener(Garnish.Modal.$shade,"click"),this.addListener(Garnish.Modal.$shade,"click","_cancelPrompt")},_handleSelection:function(t){this.trigger("response",{response:t})},_selectPromptChoice:function(t){this.$prompt.fadeOut("fast",$.proxy(function(){this.modal.hide(),this._promptCallback(t)},this))},_cancelPrompt:function(){this._selectPromptChoice("cancel",!0)}}),Answers={};Answers.Container=Garnish.Base.extend({$container:null,$items:null,$loader:null,payload:null,init:function(t){parent=this,this.$container=$(t),this.$loader=this.$container.find(".loader"),this.$items=this.$container.find(".answer-item"),this.$items.length>0&&$.each(this.$items,function(t,e){new Answers.Answer(e,parent)})}}),Answers.Answer=Garnish.Base.extend({$item:null,$actionBtn:null,$statusLabel:null,id:null,questionId:null,parent:null,payload:null,init:function(t,e){this.parent=e,this.$item=$(t),this.$actionBtn=this.$item.find(".action-btn"),this.$statusLabel=this.$item.find(".answer-status"),this.payload={id:this.$item.data("id"),questionId:this.$item.data("parent-id")},this.addListener(this.$actionBtn,"click","performAction")},performAction:function(t){var e=this,s=this,n=t.target.dataset.actionType;if("delete"===n){var a=$('<section class="hud-wrapper"><label for="">'+Craft.t("qarr","Are you sure?")+'</label></section><section class="hud-footer qarr-footer mb-4"><button type="button" class="qarr-btn btn-small cancel">'+Craft.t("qarr","Cancel")+'</button><button type="submit" class="qarr-btn btn-purple btn-small submit">'+Craft.t("qarr","Delete")+"</button></section>").appendTo(Garnish.$bod);this.hud=new Garnish.HUD(t.target,a,{hudClass:"hud qarr-hud",bodyClass:"body",closeOtherHUDs:!1});var i=this.hud.$footer.find(".cancel");this.addListener(i,"click",function(){this.hud.hide()}),this.hud.on("submit",function(t){s.deleteElement(),s.hud.hide()})}"status"===n&&(this.parent.$loader.removeClass("hidden"),this.payload.status=t.target.dataset.status,Craft.postActionRequest("qarr/answers/update-status",this.payload,$.proxy(function(t,s){t.success&&(Craft.cp.displayNotice(Craft.t("qarr","Answer status updated")),e.$item.addClass("status-changed"),e.updateAnswer())},this)))},updateAnswer:function(){"approved"===this.payload.status?(this.$statusLabel.removeClass("rejected"),this.$statusLabel.addClass("approved"),this.$item.removeClass("rejected"),this.$item.addClass("approved")):(this.$statusLabel.removeClass("approved"),this.$statusLabel.addClass("rejected"),this.$item.removeClass("approved"),this.$item.addClass("rejected")),this.$statusLabel.html(this.payload.status),this.parent.$loader.addClass("hidden")},deleteElement:function(){var t=this;this.parent.$loader.removeClass("hidden");var e={id:this.payload.id};Craft.postActionRequest("qarr/answers/delete",e,$.proxy(function(e,s){t.parent.$loader.addClass("hidden"),e.success&&(Craft.cp.displayNotice(Craft.t("qarr","Answer deleted")),t.$item.addClass("item-deleted"),t.$item.velocity("slideUp",{duration:300}))},this))},updateStatus:function(t){var e=this,s=this.statusLabelText.text();this.statusLabelText.velocity("transition.fadeOut",{duration:350,complete:function(){e.statusLabelText.html(t.status),e.$statusLabel.removeClass("status-"+s),e.$statusLabel.addClass("status-"+t.status),e.statusLabelText.velocity("transition.fadeIn",{duration:100})}})}});var ElementSelect={};ElementSelect.ElementSelectInput=Craft.BaseElementSelectInput.extend({onModalSelect:function(t){if(this.settings.limit){var e=this.settings.limit-this.$elements.length;t.length>e&&(t=t.slice(0,e))}this.selectElements(t),this.updateDisabledElementsInModal()},onSelectElements:function(t){this.trigger("selectElements",{elements:t}),this.settings.onSelectElements(t),QARR.directLinkInstance.handleAddElement(t[0])},onRemoveElements:function(){this.trigger("removeElements"),this.settings.onRemoveElements(),QARR.directLinkInstance.trigger("elementRemoved",this)}});var ConfigureElementsModal=Garnish.Modal.extend({$form:null,$modalContainer:null,$errorContainer:null,$spinner:null,elementIndex:null,type:null,target:null,init:function(t,e){this.base(),this.elementIndex=Craft.elementIndex,t&&(this.target=t),e&&(this.type=e),this.setSettings({resizable:!0}),this.getModalContent(),this.$form=$('<form class="modal elementselectormodal">').appendTo(Garnish.$bod),this.setContainer(this.$form)},getModalContent:function(){var t=this;Craft.postActionRequest("qarr/settings/configuration/get-element-settings-modal",{},$.proxy(function(e,s){e.success&&t.buildModal($(e.template))},this))},buildModal:function(t){var e=this;this.$modalContainer=t,this.$modalContainer.appendTo(this.$form),this.type&&this.target&&setTimeout(function(t){$("#elementAssetHandleName-"+e.type+"-"+e.target).focus()},100),this.show(),this.$cancelBtn=this.$modalContainer.find(".cancel"),this.$spinner=this.$modalContainer.find(".spinner"),this.addListener(this.$cancelBtn,"click","handleCancel"),this.addListener(this.$form,"submit","handleOk")},handleOk:function(t){var e=this;t.preventDefault();var s=this.$form.serialize();Craft.postActionRequest("qarr/settings/configuration/save-element-settings",s,$.proxy(function(t,s){t.success&&(e.handleSuccess(),e.elementIndex.updateElements())},this))},handleSuccess:function(){this.hide()},handleCancel:function(){this.hide()}});QarrColorInput=Garnish.Base.extend({$container:null,$input:null,$colorContainer:null,$colorPreview:null,$colorInput:null,init:function(t){this.$container=$(t),this.$input=this.$container.children(".color-input"),this.$colorContainer=this.$container.children(".color"),this.$colorPreview=this.$colorContainer.children(".color-preview"),this.createColorInput(),this.handleTextChange(),this.addListener(this.$input,"textchange","handleTextChange")},createColorInput:function(){var t=document.createElement("input");t.setAttribute("type","color"),"color"===t.type&&(this.$colorContainer.removeClass("static"),this.$colorInput=$(t).addClass("hidden").insertAfter(this.$input),this.addListener(this.$colorContainer,"click",function(){this.$colorInput.trigger("click")}),this.addListener(this.$colorInput,"change","updateColor"))},updateColor:function(){this.$input.val(this.$colorInput.val()),this.$input.data("garnish-textchange-value",this.$colorInput.val()),this.handleTextChange()},handleTextChange:function(){var t=this.$input.val();t.length&&"#"!==t?("#"!==t[0]&&(t="#"+t,this.$input.val(t),this.$input.data("garnish-textchange-value",t)),this.$colorPreview.css("background-color",t),this.$colorInput&&this.$colorInput.val(t)):this.$colorPreview.css("background-color","")}},{_browserSupportsColorInputs:null,doesBrowserSupportColorInputs:function(){return Craft.ColorInput._browserSupportsColorInputs,Craft.ColorInput._browserSupportsColorInputs}});
